VERSION 1

NODE endpoint_hourly_buckets
SQL >
    %
    SELECT
        time,
        min(latency) as min,
        max(latency) as max,
        quantile(0.5)
        (latency) as p50,
        quantile(0.95)
        (latency) as p95,
        quantile(0.99)
        (latency) as p99
    FROM checks__v2
    WHERE
        endpointId = {{ String(endpointId, required=True) }}
    AND
         time >= now64() - INTERVAL 7 DAY
    GROUP BY toStartOfInterval(time, INTERVAL 1 HOUR) as time